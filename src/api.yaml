openapi: "3.0.0"
info:
  title: CRM-SlsppIn API
  version: "1.0.0"
  description: |
    API description.
paths:
  /api:
    get:
      summary: API's first route
      tags:
        - API
      description: |
        API's first route
      operationId: firstRoute
      responses:
        "200":
          description: Returns a message for testing purposes.
          content:
            text/plain:
              schema:
                type: string
                example: Welcome to the Slsppln API
  /api/spec:
    get:
      summary: Returns the specification for the API
      tags:
        - API
      description: |
        Returns the specification for the API
      operationId: apiSpec
      responses:
        "200":
          description: Returns the specification
          content:
            text/plain:
              schema:
                type: string
                example: Welcome to the Slsppln API
  /api/filter/{model}/{attribute}:
    get:
      summary: Get filtered data from specific model.
      tags:
        - API
      parameters:
        - in: path
          name: model
          schema:
            type: string
            example: funnel
          required: true
          description: Name of the model to get filtered data from
        - in: path
          name: attribute
          schema:
            type: string
            example: name
          required: true
          description: Name of the attribute in model to get filtered data from
        - in: query
          name: value
          schema:
            type: string
            example: Test
          required: true
          description: Value to look for inside attribute
        - in: query
          name: order
          schema:
            type: string
            example: asc
          required: true
          description: Data order, asc or desc
        - in: query
          name: col
          schema:
            type: string
            example: id
          required: true
          description: Column to order the data by
      responses:
        "200":
          description: Returns the filtered data from the database
          content:
            application/json:
              schema:
                example:
                  [
                    {
                      "id": 2,
                      "name": "Test",
                      "deal_id": 1,
                      "createdAt": "2023-03-14T20:06:56.000Z",
                      "updatedAt": "2023-03-14T20:06:56.000Z",
                    },
                    {
                      "id": 1,
                      "name": "Test",
                      "deal_id": 1,
                      "createdAt": "2023-03-14T20:06:04.000Z",
                      "updatedAt": "2023-03-14T20:06:04.000Z",
                    },
                  ]
  /api/users/login:
    post:
      summary: Login Route.
      tags:
        - Users
      description: LogIn Route
      requestBody:
        description: Log user in.
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLogIn"
      responses:
        "200":
          description: Returns a response with access token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserLogInRes"
        "401":
          description: Provided credentials are not valid.
        "500":
          description: Internal Server Error
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/users/register:
    post:
      summary: Register a new user.
      tags:
        - Users
      description: Register a new user
      responses:
        "200":
          description: Returns a response with access token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserRegister"
        "401":
          description: User already exists.
        "500":
          description: Internal Server Error
  /api/funnels:
    get:
      summary: Get all Funnels.
      tags:
        - Funnels
      description: Get all funnels
      responses:
        "200":
          description: All funnels were returned succesfully
          content:
            application/json:
              example:
                [
                  {
                    "id": 1,
                    "name": "Test",
                    "deal_id": 1,
                    "createdAt": "2023-03-14T20:06:04.000Z",
                    "updatedAt": "2023-03-14T20:06:04.000Z",
                    "Users": [],
                  },
                  {
                    "id": 2,
                    "name": "Test",
                    "deal_id": 1,
                    "createdAt": "2023-03-14T20:06:56.000Z",
                    "updatedAt": "2023-03-14T20:06:56.000Z",
                    "Users": [],
                  },
                  {
                    "id": 3,
                    "name": "Test",
                    "deal_id": 1,
                    "createdAt": "2023-03-16T20:19:36.000Z",
                    "updatedAt": "2023-03-16T20:19:36.000Z",
                    "Users":
                      [
                        {
                          "id": 1,
                          "full_name": "Juan Cadavid",
                          "is_admin": false,
                          "email": "test@test.com",
                          "refresh_token": null,
                          "createdAt": "2023-03-16T20:19:21.000Z",
                          "updatedAt": "2023-03-16T20:19:21.000Z",
                          "Funnel_User":
                            {
                              "createdAt": "2023-03-16T20:19:36.000Z",
                              "updatedAt": "2023-03-16T20:19:36.000Z",
                              "FunnelId": 3,
                              "UserId": 1,
                            },
                        },
                      ],
                  },
                ]
    post:
      summary: Create a new Funnel.
      tags:
        - Funnels
      description: Create a new funnel.
      requestBody:
        description: Add new funnel
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Funnel"
      responses:
        "200":
          description: Funnel was created succesfully
          content:
            application/json:
              example:
                {
                  "id": 3,
                  "name": "Test",
                  "deal_id": 1,
                  "updatedAt": "2023-03-16T20:19:36.140Z",
                  "createdAt": "2023-03-16T20:19:36.140Z",
                }
        "404":
          description: Provided email doesn't have a user.
          content:
            application/json:
              example: { "message": "User was not found, cannot add Funnel" }
  /api/funnel/{idFunnel}:
    patch:
      summary: Update Funnel name.
      tags:
        - Funnels
      description: Update Funnel name
      requestBody:
        description: Body containing new name
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FunnelNameUpdate"
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be updated
      responses:
        "200":
          description: Funnel was succesfully updated
  /api/funnel/{idFunnel}/{email}:
    delete:
      summary: Remove Funnels.
      tags:
        - Funnels
      description: Delete funnels.
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be deleted
        - in: path
          name: email
          schema:
            type: string
            format: email
            example: johndoe@gmail.com
          required: true
          description: Email of user who is making the request
      responses:
        "200":
          description: Funnel was succesfully deleted
  /api/funnel/stage/{idFunnel}:
    post:
      summary: Create a new Stage and links it to Funnel using id.
      tags:
        - Funnels
      description: Creates a new Stage and links it to funnel using id
      requestBody:
        description: Contains Stage id
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FunnelStageUpdate"
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be updated
      responses:
        "200":
          description: Stage added to funnel
  /api/funnel/stage/{idFunnel}/{email}:
    delete:
      summary: Remove Stage and from Funnel.
      tags:
        - Funnels
      description: Delete
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be updated
        - in: path
          name: email
          schema:
            type: string
            format: email
            example: johndoe@gmail.com
          required: true
          description: Email of user who is making the request
      responses:
        "200":
          description: Stage was successfully removed from Funnel
  /api/funnel/user/{idFunnel}/{email}:
    delete:
      summary: Remove Users from Funnel
      tags:
        - Funnels
      description: Remove Users from Funnel.
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be updated
        - in: path
          name: email
          schema:
            type: string
            example: johndoe@gmail.com
          required: true
          description: Email of user making the request
      responses:
        "200":
          description: User was succesfully removed from Funnel
  /api/funnel/user/{idFunnel}:
    post:
      summary: Add Users from Funnel
      tags:
        - Funnels
      description: Add users to existing Funnel
      requestBody:
        description: Contain user emails
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FunnelUserCreate"
      parameters:
        - in: path
          name: idFunnel
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the funnel to be updated
      responses:
        "200":
          description: User was succesfully added to Funnel
  /api/leads:
    get:
      summary: Get all Leads
      tags:
        - Leads
      description: Get all existing Leads
      responses:
        "200":
          description: All leads were retuned successfully
          content:
            application/json:
              example:
                [
                  {
                    "id": 5,
                    "company": "webflow",
                    "email": "contact@webflow.com",
                    "full_name": "Luis Paul",
                    "createdAt": "2023-03-23T14:22:02.000Z",
                    "updatedAt": "2023-03-23T14:25:48.000Z",
                  },
                  {
                    "id": 7,
                    "company": "Marchi",
                    "email": "contact@marchi.com",
                    "full_name": "Vean Till",
                    "createdAt": "2023-03-23T14:22:02.000Z",
                    "updatedAt": "2023-03-23T14:25:48.000Z",
                  },
                ]
  /api/lead:
    post:
      summary: Add new Leads
      tags:
        - Leads
      description: Add new lead
      requestBody:
        description: Contains all information of lead
        required: true
        content:
          application/json:
            example:
              {
                "company": "Marketing Agency",
                "email": "contact@marketing.com",
                "full_name": "Luis Miguel",
              }
      responses:
        "200":
          description: Lead was succesfully created
          content:
            application/json:
              example: { "message": "new lead created" }
  /api/lead/{leadId}:
    get:
      summary: Get one Lead
      tags:
        - Leads
      description: Get just one lead
      parameters:
        - in: path
          name: leadId
          schema:
            type: integer
            example: 5
          required: true
          description: Id of the lead to get
      responses:
        "200":
          description: Lead was succesfully returned
          content:
            application/json:
              example:
                {
                  "company": "Marketing Agency",
                  "email": "contact@marketing.com",
                  "full_name": "Luis Miguel",
                }
    patch:
      summary: Update one Leads
      tags:
        - Leads
      description: Update one lead
      parameters:
        - in: path
          name: leadId
          schema:
            type: integer
            example: 5
          required: true
          description: Id of the lead to update
      responses:
        "200":
          description: Lead was succesfully updated
          content:
            application/json:
              example: { "message": "lead updated" }
    delete:
      summary: Remove one Lead
      tags:
        - Leads
      description: Delete one lead
      parameters:
        - in: path
          name: leadId
          schema:
            type: integer
            example: 5
          required: true
          description: Id of the lead to delete
      responses:
        "200":
          description: Lead was succesfully deleted
          content:
            application/json:
              example: { "message": "lead deleted" }
  /api/leads/order:
    get:
      summary: Get Leads sorted by name, email, company
      tags:
        - Leads
      description: Order leads by full_name, email, company
      parameters:
        - in: query
          name: o
          schema:
            type: string
          description: What you want to order, name, email, or company
        - in: query
          name: m
          schema:
            type: string
          description: DESC or ASC
      responses:
        "200":
          description: Leads ordered successfully
          content:
            application/json:
              example:
                [
                  {
                    "company": "Marketing Agency",
                    "email": "contact@marketing.com",
                    "full_name": "Luis Miguel",
                  },
                  {
                    "company": "Marketing Agency",
                    "email": "contact@marketing.com",
                    "full_name": "Luis Miguel",
                  },
                  const Note =,
                ]
  /api/leads/filter:
    get:
      summary: Filter Leads by name, email, company
      tags:
        - Leads
      description: Filter leads by full_name, email, company
      parameters:
        - in: query
          name: f
          schema:
            type: string
          description: What you want to filter, name, email, or company
        - in: query
          name: q
          schema:
            type: string
          description: search what the user wants
      responses:
        "200":
          description: Leads ordered successfully
          content:
            application/json:
              example:
                [
                  {
                    "company": "Marketing Agency",
                    "email": "contact@marketing.com",
                    "full_name": "Luis Miguel",
                  },
                  {
                    "company": "Marketing Agency",
                    "email": "contact@marketing.com",
                    "full_name": "Luis Miguel",
                  },
                ]
  /api/deals:
    get:
      summary: Get all Deals
      tags:
        - Deals
      description: Get all deals
      responses:
        "200":
          description: All deals successfully retrieved
  /api/deal/{id}:
    get:
      description: Get a deal based on id
      summary: Get a Deal by id
      tags:
        - Deals
      parameters:
        - name: id
          in: path
          description: Id of deal to fetch
          required: true
          schema:
            type: integer
            example: 5
      responses:
        "200":
          description: Deal successfully found.
    delete:
      description: Delete deal by id.
      summary: Delete deal by id
      tags:
        - Deals
      parameters:
        - name: id
          in: path
          description: Id of deal to delete
          required: true
          schema:
            type: integer
            example: 5
      responses:
        "200":
          description: Successfully deleted deal
  /api/deal/{dealId}/addUser/{userId}:
    post:
      tags:
        - Deals
      description: Add existing User to existing Deal.
      summary: Add user to deal
      parameters:
        - name: dealId
          in: path
          description: Id of Deal to link with User
          required: true
          schema:
            type: integer
            example: 4
        - name: userId
          in: path
          description: Id of User to link with Deal
          required: true
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: User successfully added to deal.
  /api/deal/{dealId}/removeUser/{userId}:
    delete:
      tags:
        - Deals
      description: Delete User from Deal.
      summary: Remove user from Deal
      parameters:
        - name: dealId
          in: path
          description: Id of Deal to update
          required: true
          schema:
            type: integer
            example: 4
        - name: userId
          in: path
          description: Id of User to remove from Deal.
          required: true
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: User successfully removed from deal.
  /api/deal/{dealId}/addStage/{stageId}:
    post:
      tags:
        - Deals
      description: Add existing User to existing Deal.
      summary: Add stage to deal
      parameters:
        - name: dealId
          in: path
          description: Id of Deal to link with Stage
          required: true
          schema:
            type: integer
            example: 4
        - name: stageId
          in: path
          description: Id of Stage to link with Deal
          required: true
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: Stage successfully added to deal.
  /api/deal/{dealId}/removeStage/{stageId}:
    delete:
      tags:
        - Deals
      description: Delete Stage from Deal.
      summary: Remove stage from deal
      parameters:
        - name: dealId
          in: path
          description: Id of Deal to update
          required: true
          schema:
            type: integer
            example: 4
        - name: stageId
          in: path
          description: Id of Stage to remove from Deal.
          required: true
          schema:
            type: integer
            example: 4
      responses:
        "200":
          description: Stage successfully removed from deal.
  /api/stages:
    get:
      tags:
        - Stages
      description: Get all Stages
      summary: Get all Stages
      responses:
        "200":
          description: All Stages successfully retrieved
  /api/stage:
    post:
      tags:
        - Stages
      summary: Create a new Stage
      description: Create a new Stage
      requestBody:
        description: Stage request body
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewStage"
      responses:
        "200":
          description: Stage created successfully.
  /api/stage/{id}:
    get:
      tags:
        - Stages
      summary: Get specific Stage by id
      description: Get a specific deal by id
      parameters:
        - name: id
          in: path
          description: Id of stage to fetch
          required: true
          schema:
            type: integer
            example: 3
      responses:
        "200":
          description: Stage successfully retrieved
    patch:
      tags:
        - Stages
      summary: Update Stage by id
      description: Update Stage by id
      requestBody:
        description: Stage request body
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStage"
      parameters:
        - name: id
          in: path
          description: Id of stage to update
          required: true
          schema:
            type: integer
            example: 3
      responses:
        "200":
          description: Stage successfully retrieved
    delete:
      summary: Delete Stage by id
      tags:
        - Stages
      description: Delete Stage by id.
      parameters:
        - name: id
          in: path
          description: Id of stage to delete
          required: true
          schema:
            type: integer
            example: 3
      responses:
        "200":
          description: Stage successfully deleted.
  /api/notes:
    get:
      summary: Get all Notes
      tags:
        - Notes
      description: Get all notes
      responses:
        "200":
          description: All notes successfully retrieved
          content:
            application/json:
              example:
                [
                  {
                    "id": 1,
                    "content": "Deal note #1",
                    "deal_id": 1,
                    "createdAt": "2023-04-10T11:00:12.000Z",
                    "updatedAt": "2023-04-12T17:30:03.000Z",
                  },
                  {
                    "id": 2,
                    "content": "Deal note #2",
                    "deal_id": 2,
                    "createdAt": "2023-04-12T17:01:57.000Z",
                    "updatedAt": "2023-04-12T17:30:21.000Z",
                  },
                ]
  /api/note/{dealId}:
    get:
      summary: Get one Note
      tags:
        - Notes
      description: Get just one note
      parameters:
        - in: path
          name: dealId
          schema:
            type: integer
            example: 1
          required: true
          description: Id of the deal to get
      responses:
        "200":
          description: Note was succesfully returned
          content:
            application/json:
              example:
                [
                  {
                    "id": 1,
                    "content": "Deal note #1",
                    "deal_id": 1,
                    "createdAt": "2023-04-10T11:00:12.000Z",
                    "updatedAt": "2023-04-12T17:30:03.000Z",
                  },
                ]
    post:
      summary: Create note
      tags:
        - Notes
      description: Add new note
      parameters:
        - in: path
          name: dealId
          schema:
            type: integer
            example: 1
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateNote"
        required: true
      responses:
        "200":
          description: Note was succesfully created
          content:
            application/json:
              example: { "message": "Note created successfully" }
        "401":
          description: Note already exists.
        "500":
          description: Internal Server Error
    patch:
      summary: Update one Note
      tags:
        - Notes
      description: Update note
      parameters:
        - in: path
          name: dealId
          schema:
            type: integer
            example: 1
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateNote"
      responses:
        "200":
          description: Note was succesfully updated
          content:
            application/json:
              example: { "message": "Note update successfully" }
    delete:
      summary: Remove Note from Deal Id
      tags:
        - Notes
      description: Delete note
      parameters:
        - in: path
          name: dealId
          schema:
            type: integer
            example:
          required: true
          description: Id of deal to note delete
      responses:
        "200":
          description: Note was succesfully deleted
          content:
            application/json:
              example: { "message": "Note deleted successfully" }
  /api/datafiles:
    get:
      tags:
        - DataFiles
      summary: Get all Datafiles
      responses:
        "200":
          description: All Datafiles retrieved successfully
  /api/datafile/{id}:
    get:
      tags:
        - DataFiles
      parameters:
        - in: path
          name: id
          schema:
            type: integer
            example: 1
          required: true
      summary: Get a Datafile by id
      responses:
        "200":
          description: Datafile was retrieved successfully
        "404":
          description: Datafile was not found.
    delete:
      tags:
        - DataFiles
      parameters:
        - in: path
          name: id
          schema:
            type: integer
            example: 1
          required: true
      summary: Delete Datafile by id
      responses:
        "200":
          description: Datafile deleted successfully.
components:
  schemas:
    CreateDataFile:
      required:
        - file
      properties:
        file:
          type: string
          format: binary
          example: Save your file in this field
        deal_id:
          type: string
          example: 5
    UpdateDataFile:
      properties:
        file:
          type: string
          format: binary
          example: Save your file in this field
        deal_id:
          type: string
          example: 5
    CreateNote:
      required:
        - content
      properties:
        content:
          type: string
          example: Note of the deal.
    UpdateStage:
      properties:
        color:
          type: string
          example: Red
        name:
          type: string
          example: Finished
    NewStage:
      required:
        - color
        - name
      properties:
        color:
          type: string
          example: Red
        name:
          type: string
          example: Finished
        deal_id:
          type: integer
          example: 6
          description: Optional deal_id to link Deal with new Stage.
    PatchDeal:
      properties:
        user_id:
          type: integer
          example: 5
        company_name:
          type: string
          example: Meta
        deal_value_estimation:
          type: integer
          example: 300
        description:
          type: string
          example: This is your description
        funnel_id:
          type: integer
          example: 5
        lead_id:
          type: integer
          example: 5
        name:
          type: string
          example: Deal with Microsoft
        logo:
          type: string
          format: binary
          example: This is where you put a logo image for the deal
        order:
          type: integer
          example: 7
        status_id:
          type: integer
          example: 7
    NewDeal:
      required:
        - company_name
        - deal_value_estimation
        - description
        - name
        - logo
        - order
      properties:
        user_id:
          type: integer
          example: 5
        company_name:
          type: string
          example: Meta
        deal_value_estimation:
          type: string
          example: 300
        description:
          type: string
          example: This is your description
        funnel_id:
          type: integer
          example: 5
        lead_id:
          type: integer
          example: 5
        name:
          type: string
          example: Deal with Microsoft
        logo:
          type: string
          format: binary
          example: This is where you put a logo image for the deal
        order:
          type: string
          example: 7
        status_id:
          type: integer
          example: 7
    Funnel:
      required:
        - name
        - deal_id
        - email
      properties:
        name:
          type: string
        deal_id:
          type: integer
        email:
          type: string
    UserRegister:
      required:
        - email
        - password
        - full_name
        - is_admin
      properties:
        email:
          type: string
          example: myemail@test.com
        password:
          type: string
          example: password
        full_name:
          type: string
          example: John Doe
        is_admin:
          type: boolean
          example: true
    UserLogIn:
      required:
        - email
        - password
      properties:
        email:
          type: string
          example: test@test.com
        password:
          type: string
          example: Mypassword123
    UserLogInRes:
      properties:
        message:
          type: string
          example: Login was successful!
        access_token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2VtYWlsIjoidGVzdDJAdGVzdC5jb20iLCJpYXQiOjE2Nzg3NDA3ODJ9.a4BYPi5gTyhoy4u76NQSaMBfQO4RA2IpeDQ6ebn7Bmg
    FunnelNameUpdate:
      required:
        - name
      properties:
        name:
          type: string
          example: Funnel Name
    FunnelStageUpdate:
      required:
        - idStage
      properties:
        idStage:
          type: integer
          example: 1
    FunnelUserCreate:
      required:
        - emailUser
      properties:
        emailUser:
          type: string
          example: jhondoe@email.com
          format: email
    CreateDeal:
      required:
        - name
        - company_name
        - deal_value_estimation
        - description
        - order
      properties:
        user_id:
          type: string
          example: 1
        company_name:
          type: string
          example: Meta
        deal_value_estimation:
          type: string
          example: "200"
        description:
          type: string
          example: My Description
        funnel_id:
          type: string
          example: "2"
        lead_id:
          type: string
          example: 1
        name:
          type: string
          example: MyDeal
        order:
          type: string
          example: "23"
        status_id:
          type: string
          example: 3
    Error:
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
